<Page x:Name="page" x:Class="EFCORE15.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:EFCORE15.Pages"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converter="clr-namespace:EFCORE15.Converters"
      xmlns:converters="clr-namespace:EFCORE15.Converters"
      xmlns:validator="clr-namespace:EFCORE15.Validators"      
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="800"
      Background="{StaticResource MaterialDesign.Brush.Background}"
      Loaded="LoadList">

    <Page.Resources>
        <converter:ConvertorTags x:Key="TagC"/>
        <converters:ConvertorStck x:Key="сonvertorStck"/>
        <validator:PriceOtDo x:Key="PriceOtDo"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <TextBox x:Name="searchText"  
          Text="{Binding searchQuery, UpdateSourceTrigger=PropertyChanged}"
          TextChanged="Search_TextChanged"
                         Grid.ColumnSpan="2"
          Style="{StaticResource MaterialDesignOutlinedTextBox}"
          materialDesign:HintAssist.Hint="Введите текст"/>
        
        <StackPanel Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" VerticalAlignment="Top" MinWidth="220">

   
            <TextBlock Text="Сортировка" FontWeight="Bold" Margin="0,65,0,0"/>

            <ComboBox x:Name="PriceComboBox" 
              SelectionChanged="Price_SelectionChanged"
              Style="{StaticResource MaterialDesignOutlinedComboBox}"
              materialDesign:HintAssist.Hint="По цене"
              Margin="0,5,0,0">
                <ComboBox.Items>
                    <ComboBoxItem Tag="ascendingPrice">По возрастанию</ComboBoxItem>
                    <ComboBoxItem Tag="descendingPrice">По убыванию</ComboBoxItem>
                </ComboBox.Items>
            </ComboBox>

            <ComboBox x:Name="SortNameComboBox" 
              SelectionChanged="SortName_SelectionChanged"
              Style="{StaticResource MaterialDesignOutlinedComboBox}"
              materialDesign:HintAssist.Hint="По названию"
              Margin="0,5,0,0">
                <ComboBox.Items>
                    <ComboBoxItem Tag="nameAZ">a-z</ComboBoxItem>
                    <ComboBoxItem Tag="nameZA">z-a</ComboBoxItem>
                </ComboBox.Items>
            </ComboBox>

            <ComboBox x:Name="StockComboBox" 
              SelectionChanged="Stock_SelectionChanged"
              Style="{StaticResource MaterialDesignOutlinedComboBox}"
              materialDesign:HintAssist.Hint="По количеству"
              Margin="0,10,0,0">
                <ComboBox.Items>
                    <ComboBoxItem Tag="ascendingStock">По возрастанию</ComboBoxItem>
                    <ComboBoxItem Tag="descendingStock">По убыванию</ComboBoxItem>
                </ComboBox.Items>
            </ComboBox>

            <TextBlock Text="Категория" Margin="0,15,0,0" FontWeight="SemiBold"/>
            <ComboBox ItemsSource="{Binding Categories}"
              x:Name="CategoriesComboBox"
              SelectionChanged="CategoriesComboBox_SelectionChanged"
              DisplayMemberPath="Name"
              SelectedValuePath="Id"
              Style="{StaticResource MaterialDesignOutlinedComboBox}"/>

            <TextBlock Text="Бренд" Margin="0,10,0,0" FontWeight="SemiBold"/>
            <ComboBox ItemsSource="{Binding Brands}"
              x:Name="BrandsComboBox"
              SelectionChanged="BrandsComboBox_SelectionChanged"
              DisplayMemberPath="Name"
              SelectedValuePath="Id"
              Style="{StaticResource MaterialDesignOutlinedComboBox}"/>

            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Label Grid.Row="0" Content="Цена" Grid.ColumnSpan="2" HorizontalAlignment="Center"/>
                <TextBlock Text="от" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="priceFromText" Grid.Row="1" Grid.Column="1" TextChanged="FilterPrice_TextChanged">
                    <TextBox.Text>
                        <Binding Path="filterPriceFrom" UpdateSourceTrigger="PropertyChanged">
                            <Binding.ValidationRules>
                                <validator:PriceOtDo/>
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>

                <TextBlock Text="до" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <TextBox x:Name="priceToText" Grid.Row="2" Grid.Column="1" TextChanged="FilterPrice_TextChanged">
                    <TextBox.Text>
                        <Binding Path="filterPriceTo" UpdateSourceTrigger="PropertyChanged">
                            <Binding.ValidationRules>
                                <validator:PriceOtDo/>
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
            </Grid>

            <Button x:Name="managerAddButton" Click="Add" Content="Добавить товар" Visibility="Visible"/>

            <Button Click="Reset" Content="Сбросить фильтры"/>

            <Button Click="Logout" Content="Выйти"/>
        </StackPanel>
        <ListView Grid.Row="1" Grid.Column="1"
                  ItemsSource="{Binding products}" Name="ProductsList"
                  HorizontalContentAlignment="Stretch"
                  MouseDoubleClick="ProductsList_MouseDoubleClick"
                  SelectedItem="{Binding product}">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border
                        BorderThickness="10"
                        BorderBrush="{Binding Stock, Converter={StaticResource сonvertorStck}}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0">
                                <Run Text="{Binding Name}" FontWeight="Bold"/>
                            </TextBlock>
                            <TextBlock Grid.Row="0" Grid.Column="1">
                                <Run Text="Цена: "/>
                                <Run Text="{Binding Price, StringFormat={}{0:N2}}"/>
                            </TextBlock>

                            <TextBlock Grid.Row="1" Grid.Column="0">
                                <Run Text="★" Foreground="#FFD700"/>   
                                <Run Text="{Binding Rating}"/>
                            </TextBlock>

                            <TextBlock Grid.Row="2" Grid.Column="0">
                                <Run Text="{Binding Category.Name}"/>
                            </TextBlock>

                            <TextBlock Text="{Binding Description}" Grid.Row="3" Grid.Column="0"/>
                            <TextBlock Grid.Row="3" Grid.Column="1">
                                <Run Text="Отстаток: "/>
                                <Run Text="{Binding Stock}"/>
                            </TextBlock>

                            <TextBlock Text="{Binding Tags, Converter={StaticResource TagC}}" Grid.Row="4" Grid.Column="0"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        <WrapPanel Background="LightGray" Grid.Row="2" Grid.ColumnSpan="2">
            <TextBlock Text="{Binding products.Count, StringFormat='{}Всего записей: {0}'}"
                       Margin="4"
                       VerticalAlignment="Center"/>
            <TextBlock Text="{Binding Items.Count, ElementName=ProductsList, StringFormat='{} Показано: {0}'}"
                       Margin="4"
                       VerticalAlignment="Center"/>
        </WrapPanel>
    </Grid>

    
</Page>
